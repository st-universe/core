{% from 'html/macros.twig' import pmWindow, userProfile %}
{% block body %}
<script src="{{ JAVASCRIPTPATH }}/js/ally.js"></script>
<table class="tcal">
    <tr>
        <th></th>
        <th>Mitglied</th>
        <th>Kolonien</th>
        <th>Schiffe</th>
        <th>Verwaltung</th>
    </tr>
    {% for data in MEMBER_LIST %}
    {% set id = data.getId %}
    <tr>
        <td style="width: 36px;">
            {{ userProfile(data.getId) }}
            {{ pmWindow(USER, data.getId) }}
        </td>
        <td>
            <div style="font-size: 120%">
                <img src="assets/rassen/{{ data.getFaction }}s.png" />
                <span>{{ data.getName|bbcode }}</span>
            </div>
            {% if CAN_VIEW_MEMBER_DATA %}
            <div>
                <img src="assets/buttons/time.png" title="Zuletzt online" />
                <span>{{ data.getLastActionDate|stuDateTime }}</span>
            </div>
            <div>
                <img src="/assets/navigation/menu_ships0.png" height="20" width="20"
                    title="Crew auf Schiffen/Stationen" />
                <span>{{ data.getCrewOnShips }}</span> / <span>{{ data.getCrewLimit }}</span>
                <img src="/assets/bev/bev_free_5_1.png" height="20" width="20" title="globales Crewlimit" />
            </div>
            {% endif %}
        </td>
        <td>
            {% if CAN_VIEW_COLONIES %}
            {% for col in data.getColonies %}
            <a href="javascript:void(0);" onclick="showMemberColonyInfo(this, {{ col.getId }});">
                <img src="assets/planets/{{ col.getColonyClass.getId }}.png"
                    title="{{ col.getName|bbcode2txt }} {{ col.getSectorString }} (Klicke für Details)" />
            </a>
            {% endfor %}
            {% else %}
            Keine Berechtigung
            {% endif %}
        </td>
        <td>
            {% if CAN_VIEW_SHIPS %}
            {% for rump in data.getShipRumpList %}
            <div style="display: inline-block; padding-left: 10px; text-align: center;">
                {{ rump.amount }} {{ rump.name }}<br />
                <a href="javascript:void(0);" onclick="showMemberRumpInfo(this, {{ data.getId }}, {{ rump.rump_id }});">
                    <img src="assets/ships/{{ rump.rump_id }}.png" title="{{ rump.name }} (Klick für Details)" />
                </a>
            </div>
            {% endfor %}
            {% else %}
            Keine Berechtigung
            {% endif %}
        </td>
        <td style="width: 200px; text-align: center;">
            {% if CAN_MANAGE_JOBS %}
            {% if not data.isCurrentUser %}
            {% if not data.isFounder %}
            <a href="javascript:void(0);" class="linkbutton"
                onclick="toggleVisible('promote{{ data.getId }}');">Befördern</a>
            <div id="promote{{ data.getId }}"
                style="border-top: 1px solid #262323; margin-top: 10px; padding-top: 10px; display: none;">
                {% for job in ALLIANCE_JOBS %}
                <a href="alliance.php?B_PROMOTE_USER=1&type={{ job.getId }}&uid={{ data.getId }}&sstr={{ SESSIONSTRING }}"
                    class="linkbutton">{{ job.getTitle }}</a><br /><br />
                {% endfor %}
            </div>
            {% if data.canBeDemoted %}
            <br /><br />
            <a href="alliance.php?B_DEMOTE_USER=1&uid={{ data.getId }}&sstr={{ SESSIONSTRING }}"
                class="linkbutton negative">Degradieren</a>
            {% endif %}
            {% endif %}
            {% endif %}
            {% if data.canBeKicked %}
            <br />
            <br />
            {% if not data.isCurrentUser %}
            <a href="alliance.php?B_KICK_USER=1&SHOW_MANAGEMENT=1&uid={{ data.getId }}&sstr={{ SESSIONSTRING }}"
                class="linkbutton negative">Rauswerfen</a>
            {% endif %}
            {% endif %}
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% if CAN_VIEW_ALLIANCE_STORAGE %}
{% if ALLIANCE_STATIONS|length > 0 %}
<br /><br />
<div class="divhead">Allianz-Depots</div>
<br />
<div style="display: grid; grid-template-columns: 49% 49%; grid-column-gap: 2%;">
    {% for wrapper in ALLIANCE_STATIONS %}
    {% set station = wrapper.get %}
    <div style="margin-bottom: 20px;">
        <table class="tcal">
            <tr>
                <th colspan="2">{{ station.getName|bbcode }}</th>
            </tr>
            <tr>
                <td rowspan="4" style="width: 150px; text-align: center;">
                    <img src="assets/ships/{{ station.getRump.getId }}.png" />
                </td>
                <td>
                    <strong>Besitzer:</strong> {{ station.getUser.getName|bbcode }}
                </td>
            </tr>
            <tr>
                <td>
                    <strong>Standort:</strong>
                    <img src="/assets/buttons/layer_{{ station.getLocation.getLayer.getId }}.png"
                        title="{{ station.getLocation.getLayer.getName }}" style="vertical-align: middle;" />
                    {% if station.getSystem %}
                    {{ station.getStarsystemMap.getSx }}|{{ station.getStarsystemMap.getSy }} ({{
                    station.getSystem.getName }}-System {{ station.getSystem.getCx }}|{{ station.getSystem.getCy }})
                    {% else %}
                    {{ station.getSectorString }}
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <div style="font-weight: bold; margin-top: 10px;">Waren im Lager:</div>
                    <div style="max-height: 200px; overflow-y: auto;">
                        {% for stor in station.getStorage %}
                        <div style="display: inline-block; width: 80px; text-align: center; margin: 5px;">
                            <img src="assets/commodities/{{ stor.getCommodity.getId }}.png"
                                title="{{ stor.getCommodity.getName }}" />
                            <div>{{ stor.getAmount }}</div>
                        </div>
                        {% endfor %}
                        {% if station.getStorage|length == 0 %}
                        <div style="padding: 10px">Lager ist leer</div>
                        {% endif %}
                    </div>
                </td>
            </tr>
        </table>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endif %}

{% endblock %}