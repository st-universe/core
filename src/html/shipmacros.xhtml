<html xmlns:stu="stu">
<metal:macro metal:define-macro="shipimagewithoutwarp">
  <tal:block tal:condition="ship/isTrumfield">
    <img src="assets/ships/wrack/${ship/getFormerRumpId}.png" tal:attributes="title ship/getRumpName" />
  </tal:block>
  <tal:block tal:condition="not:ship/isTrumfield">
    <img tal:condition="ship/getCloakState" src="assets/ships/${ship/getRumpId}_cloaked.png" style="opacity:0.55;"
      tal:attributes="title ship/getRumpName" />
    <img tal:condition="not:ship/getCloakState" src="assets/ships/${ship/getRumpId}.png"
      tal:attributes="title ship/getRumpName" />
  </tal:block>
</metal:macro>
<metal:macro metal:define-macro="hiddenshipid" phptal:cache="1m per SHIP/getId">
  <input type="hidden" name="id" tal:attributes="value SHIP/getId" />
</metal:macro>
<metal:block metal:define-macro="show_ship_alvl">
  <table style="width: 100%;" tal:define="sstr THIS/getSessionString">
    <tr>
      <td>
        <a href="?B_SET_GREEN_ALERT=1&id=${SHIP/getId}&sstr=${sstr}">
          <img src="assets/buttons/alert1.png" /> Alarmstufe Grün
        </a>
      </td>
    </tr>
    <tr>
      <td>
        <a href="?B_SET_YELLOW_ALERT=1&id=${SHIP/getId}&sstr=${sstr}">
          <img src="assets/buttons/alert2.png" /> Alarmstufe Gelb
        </a>
      </td>
    </tr>
    <tr>
      <td>
        <a href="?B_SET_RED_ALERT=1&id=${SHIP/getId}&sstr=${sstr}">
          <img src="assets/buttons/alert3.png" /> Alarmstufe Rot
        </a>
      </td>
    </tr>
  </table>
</metal:block>
<metal:block metal:define-macro="show_ship_etransfer">
  <form action="ship.php" method="post" tal:define="SHIP WRAPPER/get">
    <input type="hidden" name="id" tal:attributes="value SHIP/getId" />
    <input type="hidden" name="target" tal:attributes="value targetShip/getId" />
    <input type="hidden" name="sstr" tal:attributes="value THIS/getSessionString" />
    <table class="tcal" tal:define="eps WRAPPER/getEpsSystemData">
      <tr>
        <td>Ziel: <span tal:replace="structure bbcode:targetShip/getName">...</span></td>
      </tr>
      <tr>
        <td>Verfügbare Energie: ${eps/getEps}/${eps/getMaxEps}</td>
      </tr>
      <tr>
        <td>
          <img src="assets/buttons/e_trans2.png" title="Energietransfer" />
          <input type="text" size="4" name="ecount" id="etransfer_value" />
          <input type="submit" class="button" value="transferieren" name="B_ETRANSFER" id="etransfer_button" />
          <input type="button" class="button" value="max" name="B_MAX_ETRANSFER"
            onclick="$('etransfer_value').value = '${eps/getEps}'; $('etransfer_button').click()" />
        </td>
      </tr>
    </table>
  </form>
</metal:block>
<metal:block metal:define-macro="shipselector">
  <span tal:condition="not:AVAILABLE_SHIPS">Keine Schiffe vorhanden</span>
  <tal:block tal:condition="AVAILABLE_SHIPS">
    <table class="tcal" id="availableShipsTable">
      <tr tal:repeat="ship AVAILABLE_SHIPS">
        <td tal:attributes="style ship/getHoldingWebBackgroundStyle" class="shiplistshipimage">
          <metal:macro metal:use-macro="html/shipmacros.xhtml/shipimagewithoutwarp" />
        </td>
        <td><input type="checkbox" class="chosenShipsCheckbox" name="chosen[]" value="${ship/getId}" /><span
            tal:content="structure bbcode:ship/getName">NAME</span></td>
      </tr>
    </table>
  </tal:block>
</metal:block>
<metal:block metal:define-macro="show_available_ships">
  <form action="ship.php" method="post">
    <input type="hidden" name="fleetid" tal:attributes="value FLEET/getId" />
    <input type="hidden" name="sstr" tal:attributes="value THIS/getSessionString" />
    <metal:block metal:use-macro="shipselector" />
    <a tal:condition="AVAILABLE_SHIPS" href="javascript:void(0);" onclick="joinFleetInShiplist(${FLEET/getId});"
      title="Schiffe hinzufügen" class="fabutton">Schiffe hinzufügen</a>
  </form>
</metal:block>
<metal:block metal:define-macro="selfdestruct">
  <form action="ship.php" method="post">
    <input type="hidden" name="id" tal:attributes="value SHIP/getId" />
    <input type="hidden" name="sstr" value="runtime" tal:attributes="value THIS/getSessionString" />
    <table class="tcal">
      <tr>
        <td colspan="2">Tippe folgenden Code in das Feld um die Selbstzerstörung zu bestätigen.</td>
      </tr>
      <tr>
        <td tal:content="SELF_DESTRUCT_CODE" style="text-align: center; color: Red;">CODE</td>
        <td>
          <input type="text" size="8" name="destructioncode" />
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <input type="submit" class="button" name="B_SELFDESTRUCT" value="Bestätigen" />
        </td>
      </tr>
    </table>
  </form>
</metal:block>
<metal:block metal:define-macro="webemitter">
  <form action="ship.php" method="post" tal:define="SHIP WRAPPER/get; emitter WRAPPER/getWebEmitterSystemData;">
    <input type="hidden" name="id" tal:attributes="value SHIP/getId" />
    <input type="hidden" name="sstr" value="runtime" tal:attributes="value THIS/getSessionString" />
    <table class="tcal" tal:condition="SHIP/isWebEmitterHealthy">
      <tal:block tal:condition="exists:OWNFINISHEDWEB">
        <tr>
          <th colspan="2">
            Eigenes Netz bei ${OWNFINISHEDWEB/getWebShip/getSectorString}
          </th>
        </tr>
        <tr>
          <td colspan="2">
            <input type="submit" class="button" name="B_IMPLODE_WEB" value="Netz implodieren lassen" />
            <input type="submit" class="button" name="B_REMOVE_WEB" value="Netz auflösen" />
          </td>
        </tr>
      </tal:block>
      <tal:block tal:condition="exists:WEBCONSTRUCT">
        <tr>
          <td>Netz wird erstellt</td>
          <td><input tal:condition="ISOWNCONSTRUCT" type="submit" class="button" name="B_CANCEL_WEB"
              value="Abbrechen" /><input tal:condition="not:ISOWNCONSTRUCT" type="submit" class="button"
              name="B_UNSUPPORT_WEB" value="Unterstützung abbrechen" /></td>
        </tr>
        <tr>
          <td colspan="2">Fertigstellung ${datetime:WEBCONSTRUCT/getFinishedTime}</td>
        </tr>
      </tal:block>
      <tr tal:condition="exists:CANHELP">
        <td>Netzerstellung kann unterstützt werden</td>
        <td><input type="submit" class="button" name="B_SUPPORT_WEB" value="Unterstützen" />
        </td>
      </tr>
      <tal:block tal:condition="exists:OWNFINISHED">
        <tr tal:condition="not:OWNFINISHED">
          <td>Es existiert hier bereits ein Energienetz</td>
        </tr>
      </tal:block>
      <tr>
        <td colspan="2">
          <div class="box" tal:condition="exists:AVAILABLE_SHIPS">
            <div class="box_title">Zielauswahl</div>
            <div class="box_body">
              <metal:block metal:use-macro="shipselector" />
              <tal:block tal:condition="AVAILABLE_SHIPS">
                <br />
                <input type="submit" class="button" name="B_CREATE_WEB" value="Schiffe einfangen" />
              </tal:block>
            </div>
          </div>
        </td>
      </tr>

      <tr>
        <td colspan="2">
          <div class="box" tal:condition="exists:COOLDOWN">
            <div class="box_title">Zielauswahl</div>
            <div class="box_body">
              Gesperrt bis ${datetime:COOLDOWN}
            </div>
          </div>
        </td>
      </tr>

    </table>
  </form>
</metal:block>
<metal:block metal:define-macro="scrapping">
  <form action="ship.php" method="post">
    <input type="hidden" name="id" tal:attributes="value SHIP/getId" />
    <input type="hidden" name="sstr" value="runtime" tal:attributes="value THIS/getSessionString" />
    <table class="tcal">
      <tr>
        <td colspan="2">Tippe folgenden Code in das Feld um das Demontieren zu bestätigen.</td>
      </tr>
      <tr>
        <td tal:content="SCRAP_CODE" style="text-align: center; color: Red;">CODE</td>
        <td>
          <input type="text" size="8" name="scrapcode" />
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <input type="submit" class="button" name="B_SCRAP" value="Bestätigen" />
        </td>
      </tr>
    </table>
  </form>
</metal:block>
<metal:block metal:define-macro="show_ship_scan">
  <metal:block metal:use-macro="html/sitemacros.xhtml/systeminformation" />
  <tal:block tal:condition="exists:TARGETWRAPPER">
    <div class="box">
      <div class="box_body">
        <table class="tcal">
          <tr>
            <td style="width: 50%" class="selected" id="menuScanDetails">
              <a style="display: block;" href="javascript:void(0);" onclick="switchScanToDetails()">Details</a>
            </td>
            <td style="width: 50%" id="menuScanLogbook">
              <a style="display: block;" href="javascript:void(0);" onclick="switchScanToLogbook()">Logbuch</a>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div id="scandetails" style="width: 500px;" tal:define="targetShip TARGETWRAPPER/get">
      <tal:block tal:condition="not:targetShip/isDestroyed">
        <table class="tcal" tal:condition="php:SHIP.isMatrixScannerHealthy() AND NOT SHIP.getCloakState()"
          tal:define="targetShipEps TARGETWRAPPER/getEpsSystemData">
          <tr>
            <th colspan="2">Details</th>
          </tr>
          <tr>
            <td>Lebenszeichen</td>
            <td>${targetShip/getCrewCount}</td>
          </tr>
          <tr>
            <td>Alarmstufe</td>
            <td style="text-align: center;">
              <img src="assets/buttons/alert${targetShip/getAlertState/value}_1.png" title="Alarmstufe" />
            </td>
          </tr>
          <tr>
            <td>Schilde</td>
            <td>${SHIELD_PERCENTAGE}%</td>
          </tr>
          <tal:block tal:condition="targetShipEps">
            <tr>
              <td>Energie</td>
              <td>${targetShipEps/getEps}</td>
            </tr>
            <tr>
              <td>Ersatzbatterie</td>
              <td>${targetShipEps/getBattery}</td>
            </tr>
          </tal:block>
          <tr tal:condition="REACTOR_PERCENTAGE">
            <td>Reaktor</td>
            <td>${REACTOR_PERCENTAGE}%</td>
          </tr>
          <tr tal:condition="targetShip/getBuildplan">
            <td>Verbaute Module</td>
            <td><img tal:repeat="mod targetShip/getModules" style="margin-right: 5px;"
                src="assets/commodities/${mod/getCommodityId}.png" title="${mod/getName}" /></td>
          </tr>
        </table>
        <br />
        <form action="ship.php" method="post">
          <input type="hidden" name="id" tal:attributes="value SHIP/getId" />
          <br />
          <table class="tcal" tal:condition="not:targetShip/getRump/isTrumfield">
            <tr>
              <th>Systemzustand</th>
            </tr>
            <tr>
              <td style="width: 450px;">
                <div style="float: left; width: 150px;" tal:repeat="data targetShip/getSystems">
                  <img title="${data/getName}" class="${data/getCssClass}"
                    src="assets/system/${data/getSystemType/value}.png" />
                  ${data/getStatus}%
                </div>
              </td>
            </tr>
          </table>
          <table class="tcal" tal:condition="targetShip/hasEscapePods">
            <tr>
              <th>Rettungskapseln</th>
            </tr>
            <tr>
              <td style="width: 450px;">
                <span>Es befinden sich <span tal:replace="targetShip/getCrewCount" /> Crewman in den
                  Rettungskapseln</span><br /><br />
                <input type="hidden" name="target" tal:attributes="value targetShip/getId" />
                <input type="submit" style="cursor: pointer;" name="B_SALVAGE_EPODS" value="Rettungskapseln bergen" />
              </td>
            </tr>
          </table>
          <table class="tcal" tal:condition="TRADE_POST_CREW_COUNT">
            <tr>
              <th>Eigene Crew bergen</th>
            </tr>
            <tr>
              <td style="width: 450px;">
                <span>Es befinden sich <span tal:replace="TRADE_POST_CREW_COUNT" />
                  eigene
                  Crewman an Bord des Handelsposten</span><br /><br />
                <input type="hidden" name="target" tal:attributes="value targetShip/getId" />
                <input type="submit" style="cursor: pointer;" name="B_SALVAGE_CREW" value="Crew bergen" />
              </td>
            </tr>
          </table>
        </form>
      </tal:block>
      <tal:block tal:condition="targetShip/isDestroyed">
        <span>Ziel ist zerstört</span>
      </tal:block>
    </div>
    <div class="box" id="scanlogbook" style="width: 500px; display: none;">
      <div class="box_title">Logbuch</div>
      <div class="box_body" tal:define="target TARGETWRAPPER/get">
        <tal:block tal:repeat="data target/getLogbook">
          <table class="tcal">
            <tr>
              <th style="width: 120px; text-align: center;" tal:content="datetime:data/getDate">DATE</th>
            </tr>
            <tr>
              <td tal:content="structure bbcode:nl2br:data/getText">TEXT</td>
            </tr>
          </table>
          <br tal:condition="not:repeat/data/end" />
        </tal:block>
        <div class="divhead" tal:condition="not:target/getLogbook" style="text-align: center;">Keine Logbucheinträge
          vorhanden
        </div>
      </div>
    </div>
  </tal:block>
</metal:block>
<metal:macro metal:define-macro="crewslot">
  <div id="rn_crew_${CREW/getId}" tal:condition="not:php: CREW.getUser().getId() EQ SHIP.getUser().getId()">
    <div tal:content="CREW/getName" style="font-weight: bold;">NAME</div>
  </div>
  <div id="rn_crew_${CREW/getId}" tal:condition="php: CREW.getUser().getId() EQ SHIP.getUser().getId()">
    <div onclick="showRenameCrew(this,${CREW/getId});" tal:content="CREW/getName" class="action"
      style="font-weight: bold;">NAME</div>
    <div id="rn_crew_${CREW/getId}_input" style="display: none;">
      <input type="text" size="15" tal:attributes="value CREW/getName" id="rn_crew_${CREW/getId}_value"
        name="rn_crew_${CREW/getId}_value" />
      <input type="button" class="button" value="Ok" onclick="renameCrew(${CREW/getId})" />
    </div>
  </div>
</metal:macro>
<metal:block metal:define-macro="shipstorage">
  <table class="use" style="width: 200px;">
    <tr>
      <th><img onClick="window.scrollTo(0,0);" src="assets/buttons/lager.png" title="Lagerraum" /> Lagerraum
        ${SHIP/getStorageSum}/${SHIP/getMaxStorage}</th>
    <tr>
      <td>
        <tal:block tal:repeat="commodity SHIP/getStorage">
          <tal:block tal:condition="commodity/getAmount">
            <div tal:condition="repeat/commodity/odd" style="float: right; width: 50%;">
              <img src="assets/commodities/${commodity/getCommodity/getId}.png"
                tal:attributes="title commodity/getCommodity/getName" />
              ${commodity/getAmount}
            </div>
            <tal:block tal:condition="repeat/commodity/odd">
              <div tal:condition="repeat/commodity/last" style="float: left; width: 50%;"> </div>
            </tal:block>
            <div tal:condition="repeat/commodity/even" style="float: left; width: 50%;">
              <img src="assets/commodities/${commodity/getCommodity/getId}.png"
                tal:attributes="title commodity/getCommodity/getName" />
              ${commodity/getAmount}
            </div>
            <br tal:condition="repeat/commodity/odd" style="clear: both;" />
          </tal:block>
        </tal:block>
      </td>
    </tr>
    </tr>
  </table>
</metal:block>
<metal:block metal:define-macro="shipcommunication">
  <div class="box">
    <div class="box_title">Menü</div>
    <div class="box_body">
      <table class="tcal">
        <tr>
          <td style="width: 33%" class="selected" id="menubroadcast">
            <a style="display: block;" href="javascript:void(0);" onclick="switchMenuToBroadcast()">Broadcast</a>
          </td>
          <td style="width: 33%" id="menulogbook">
            <a style="display: block;" href="javascript:void(0);" onclick="switchMenuToLogbook()">Logbuch</a>
          </td>
          <td style="width: 33%" id="menuemergency">
            <a style="display: block;" href="javascript:void(0);" onclick="switchMenuToEmergency()">Notruf</a>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <div class="box" id="broadcast" style="width: 500px;">
    <div class="box_title">Broadcast</div>
    <div class="box_body">
      <form method="post" action="ship.php">
        <input type="hidden" name="id" tal:attributes="value SHIP/getId" />
        <table class="tcal">
          <tr>
            <th>Sende Broadcast an alle Kolonien und Stationen im Umkreis von einem Feld</th>
          </tr>
          <tr>
            <td><textarea tal:content="TEMPLATETEXT" name="text" style="width: 100%; height: 300px;"></textarea></td>
          </tr>
          <tr>
            <td><input type="submit" name="B_SEND_BROADCAST" class="button" value="Broadcast senden" /></td>
          </tr>
        </table>
      </form>
    </div>
  </div>
  <div class="box" id="logbook" style="width: 500px; display: none;">
    <div class="box_title">Logbuch</div>
    <div class="box_body">
      <form method="post" action="ship.php">
        <input type="hidden" name="id" tal:attributes="value SHIP/getId" />
        <div id="writelog" style="display: none;">
          <table class="tcal">
            <tr>
              <th colspan="2">Kommentar schreiben</th>
            </tr>
            <tr>
              <td colspan="2">
                <textarea style="width: 100%; height: 100px;" name="log" id="log" />
              </td>
            </tr>
            <tr>
              <td colspan="2" style="text-align: right;">
                <input type="submit" class="button" name="B_ADD_SHIP_LOG" value="Eintrag erstellen" />
              </td>
            </tr>
          </table>
        </div>
        <div style="width: 100%; text-align: right;"><input type="button" class="button" value="Logeintrag schreiben"
            onclick="Element.hide(this.parentNode);Element.show($('writelog'))" /></div>
        <br />
        <tal:block tal:repeat="data SHIP/getLogbook">
          <table class="tcal">
            <tr>
              <th style="width: 120px; text-align: center;" tal:content="datetime:data/getDate">DATE</th>
            </tr>
            <tr>
              <td tal:content="structure bbcode:nl2br:data/getText">TEXT</td>
            </tr>
          </table>
          <br tal:condition="not:repeat/data/end" />
        </tal:block>
        <div class="divhead" tal:condition="not:SHIP/getLogbook" style="text-align: center;">Keine Logbucheinträge
          vorhanden
        </div>
      </form>
    </div>
  </div>
  <div class="box" id="emergency" style="width: 500px; display: none;">
    <div class="box_title">Notruf</div>
    <div class="box_body">
      <form method="post" action="ship.php">
        <input type="hidden" name="id" tal:attributes="value SHIP/getId" />
        <table class="tcal" tal:condition="not:SHIP/getIsInEmergency">
          <tr>
            <th colspan="2">Sende Notrufsignal</th>
          </tr>
          <tr>
            <td colspan="2"><textarea id="emergencytext" name="text" style="width: 100%; height: 300px;"></textarea>
            </td>
          </tr>
          <tr>
            <td style="width: 200px">
              <span id="emergencyTextLength">0</span>/<span tal:replace="EMERGENCYTEXTLIMIT">LIMIT</span>
              <span>Zeichen</span>
            </td>
            <td><input id="startEmergencyButton" type="submit" name="B_START_EMERGENCY" class="button"
                value="Notruf senden" /></td>
          </tr>
        </table>
        <table class="tcal" tal:condition="SHIP/getIsInEmergency">
          <tr>
            <th>Aktuelles Notrufsignal</th>
          </tr>
          <tr>
            <td>${EMERGENCYTEXT}</td>
          </tr>
          <tr>
            <td><input type="submit" name="B_STOP_EMERGENCY" class="button" value="Notruf beenden" /></td>
          </tr>
        </table>
      </form>
    </div>
  </div>
  <script>
    $('emergencytext').addEventListener(
      "keyup",
      function () {
        limit = ${EMERGENCYTEXTLIMIT};

        var length = this.value.length;
        $('emergencyTextLength').innerHTML = length;
        if (length > limit) {
          $('emergencyTextLength').addClassName('error');
          $('startEmergencyButton').disabled = true;
        } else {
          $('emergencyTextLength').removeClassName('error');
          $('startEmergencyButton').disabled = false;
        }
      },
      false
    );
  </script>
</metal:block>
<metal:block metal:define-macro="shipdetails">
  <tal:block tal:define="SHIP WRAPPER/get; eps WRAPPER/getEpsSystemData">
    <br />
    <div style="width: 100%">
      <div style="width: 33%; float: left;">
        <table class="tcal" tal:define="hull WRAPPER/getHullSystemData">
          <tr>
            <th style="width: 20px; text-align: center;">
              <img src="assets/buttons/modul_1.png" />
            </th>
            <td style="vertical-align: middle; text-align: center;">
              <span tal:replace="structure hull/getHullStatusBarBig">HULL</span>
            </td>
            <td style="text-align: center; width: 60px;">
              ${SHIP/getHull}
            </td>
          </tr>
        </table>
      </div>
      <div style="width: 33%; float: left;" tal:define="shields WRAPPER/getShieldSystemData">
        <table class="tcal" tal:condition="shields">
          <tr>
            <th style="width: 20px; text-align: center;">
              <img src="assets/buttons/modul_2.png" />
            </th>
            <td style="text-align: center; vertical-align: middle;">
              <span tal:replace="structure shields/getShieldStatusBarBig">SCHILDE</span>
            </td>
            <td style="text-align: center; width: 60px;">
              ${SHIP/getShield}
            </td>
          </tr>
        </table>
      </div>
      <div style="width: 33%; float: left;">
        <table class="tcal" tal:condition="eps">
          <tr>
            <th style="text-align: center; width: 20px;">
              <img src="assets/buttons/modul_8.png" />
            </th>
            <td style="vertical-align: middle; text-align: center;">
              <span tal:replace="structure eps/getEpsStatusBarBig">EPS</span>
            </td>
            <td style="text-align: center; width: 60px;">
              ${eps/getEps}
            </td>
          </tr>
        </table>
      </div>
    </div>
    <br style="clear: both;" />
    <br />
    <div style="display: grid; grid-template-columns: 49% 49%; grid-column-gap: 2%">
      <div>
        <table class="tcal">
          <tr>
            <th colspan="4">Crew</th>
          </tr>
          <tr>
            <td colspan="3" class="darkbg">Minimal-Crew</td>
            <td class="darkbg"><span tal:condition="SHIP/getBuildplan"
                tal:replace="SHIP/getBuildplan/getCrew">CREW</span><span tal:condition="not:SHIP/getBuildplan">kA</span>
            </td>
          </tr>
          <tr>
            <td class="darkbg"></td>
            <td class="darkbg"><strong>Position</strong></td>
            <td class="darkbg"><strong>Name</strong></td>
            <td class="darkbg"><strong>Rang</strong></td>
          </tr>
          <tr tal:repeat="data SHIP/getCrewAssignments">
            <td tal:define="crewusername bbcode2txt:data/getCrew/getUser/getName">
              <img
                src="assets/crew/${data/getCrew/getRace/getGfxPath}/${data/getCrew/getGenderShort}/1_${data/getCrew/getType}.png" />
              <span tal:condition="data/isForeigner" style="vertical-align: top; color:red; cursor: default;"
                title="von ${crewusername}">*</span>
              <a tal:condition="data/isForeigner"
                href="?B_DUMP_CREWMAN=1&id=${SHIP/getId}&scid=${data/getId}&sstr=${THIS/getSessionString}"
                onmouseover="cp('dump_${data/getId}','buttons/x2')" onmouseout="cp('dump_${data/getId}','buttons/x1')">
                <img src="/assets/buttons/x2.png" name="dump_${data/getId}" title="Crewman entfernen" />
              </a>
            </td>
            <td>
              <div tal:content="data/getPosition">POSITION</div>
            </td>
            <td style="vertical-align: middle;">
              <metal:macro metal:use-macro="crewslot" tal:define="CREW data/getCrew" />
            </td>
            <td>
              <div tal:content="data/getCrew/getTypeDescription">RANG</div>
            </td>
          </tr>
        </table>
      </div>
      <div>
        <div class="divhead">Informationen</div>
        <div class="divbody" tal:define="reactor WRAPPER/getReactorWrapper">
          <span>Ersatzbatterie:</span> <span tal:condition="eps">${eps/getMaxBattery}</span><br />
          <span>Trefferchance (eff.):</span> ${SHIP/getHitChance}%<br />
          <span>Ausweichchance (eff.):</span> ${SHIP/getEvadeChance}%<br />
          <span>Schildregeneration:</span> ${SHIP/getShieldRegenerationRate}<br />
          <tal:block tal:condition="reactor">
            <span>Reaktorleistung:</span> ${reactor/get/getTheoreticalReactorOutput}<br />
          </tal:block>
          <span>Sensorreichtweite:</span> ${SHIP/getSensorRange}<br />
          <tal:block tal:condition="SHIP/canMove">
            <span>Flugkosten</span>: ${SHIP/getRump/getFlightEcost}<br />
          </tal:block>
          <span>Beamfaktor</span>: ${SHIP/getRump/getBeamFactor}<br />
          <span>Raumschiffmasse: </span><span
            tal:content="numberWithThousandSeperator:SHIP/getRump/getTractorMass">TRACTORMASS</span><br />
          <span>Traktortraglast: </span><span
            tal:content="numberWithThousandSeperator:SHIP/getTractorPayload">TRACTORPAYLOAD</span><br />
          <span>Energiewaffensalven</span>: ${SHIP/getRump/getPhaserVolleys}<br />
          <span>Energiewaffenbasisschaden</span>: ${SHIP/getBaseDamage}<br />
          <span>Torpedolevel</span>: ${SHIP/getRump/getTorpedoLevel}<br />
          <span>Torpedosalven</span>: ${SHIP/getRump/getTorpedoVolleys}<br />
          <tal:block tal:condition="SHIP/getTorpedo">
            <span>Torpedobasisschaden</span>: ${SHIP/getTorpedo/getBaseDamage}<br />
          </tal:block>
          <span>Torpedokapazität</span>: ${SHIP/getMaxTorpedos}<br />
          <tal:block tal:condition="SHIP/isBase">
            <span>Dockplätze</span>: ${SHIP/getRump/getDockingSlots}<br />
          </tal:block>
        </div>
        <br />
        <div class="divhead">Systemstatus</div>
        <div class="divbody">
          <div tal:repeat="data SHIP/getSystems">
            <img style="vertical-align: middle" title="${data/getName}" class="${data/getCssClass}"
              src="assets/system/${data/getSystemType/value}.png" />
            ${data/getName}: ${data/getStatus}%
          </div>
        </div>
      </div>
    </div>
  </tal:block>
</metal:block>
<metal:macro metal:define-macro="trademenu">
  <div id="trademenucontent" style="width: 400px;">
    <tal:block tal:condition="THIS/getInformation">
      <br />
      <metal:macro metal:use-macro="html/sitemacros.xhtml/systeminformation" />
    </tal:block>
    <tal:block tal:condition="HAS_LICENSE">
      <form method="post" action="ship.php">
        <input type="hidden" name="id" tal:attributes="value SHIP/getId" />
        <input type="hidden" name="postid" tal:attributes="value TRADEPOST/getId" />
        <input type="hidden" name="sstr" tal:attributes="value THIS/getSessionString" />
        <br />
        <table class="tcal">
          <tr>
            <th style="width: 50%;">Warenkonto</th>
            <th>Schiff</th>
          </tr>
          <tr>
            <td>
              <img src="assets/buttons/lager.png" />
              <span tal:replace="TRADEPOST/getStorageSum">SUM</span>/<span
                tal:replace="TRADEPOST/getStorageCapacity">MAX</span>
            </td>
            <td>
              <img src="assets/buttons/lager.png" />
              <span tal:replace="SHIP/getStorageSum">SUM</span>/<span tal:replace="SHIP/getRump/getStorage">MAX</span>
            </td>
          </tr>
        </table>
        <br />
        <table class="tcal">
          <tr>
            <th>Modus</th>
          </tr>
          <tr>
            <td style="width: 50%" class="selected" id="transfertoaccount">
              <a style="display: block;" href="javascript:void(0);"
                onclick="switchTransferToAccount(${TRADEPOST/getId})">Transfer in Konto</a>
            </td>
            <td style="width: 50%" id="transferfromaccount">
              <a style="display: block;" href="javascript:void(0);"
                onclick="switchTransferFromAccount(${TRADEPOST/getId})">Transfer von Konto</a>
            </td>
          </tr>
        </table>

        <div id="trademenutransfer">
          <metal:macro metal:define-macro="transfertoaccount">
            <br />
            <input type="hidden" name="B_TRANSFER_TO_ACCOUNT" value="1" />
            <table class="tcal">
              <tr>
                <th>Waren auf dem Schiff</th>
              </tr>
              <tr>
                <td>
                  <tal:block tal:condition="SHIP/getBeamableStorage" tal:repeat="stor SHIP/getBeamableStorage">
                    <input type="hidden" name="commodities[]" tal:attributes="value stor/getCommodity/getId" />
                    <div tal:condition="repeat/stor/odd" style="float: right; width: 50%;">
                      <metal:macro metal:use-macro="macros.xhtml/commoditySelection"
                        tal:define="name stor/getCommodity/getName; commodityId stor/getCommodity/getId; amount stor/getAmount" />
                    </div>
                    <div tal:condition="repeat/stor/even" style="float: left; width: 50%;">
                      <metal:macro metal:use-macro="macros.xhtml/commoditySelection"
                        tal:define="name stor/getCommodity/getName; commodityId stor/getCommodity/getId; amount stor/getAmount" />
                    </div>
                    <br tal:condition="repeat/stor/odd" style="clear: both;" />
                  </tal:block>
                  <tal:block tal:condition="not:SHIP/getBeamableStorage">
                    Keine Waren vorhanden
                  </tal:block>
                </td>
              </tr>
            </table>
          </metal:macro>
          <metal:macro metal:define-macro="transferfromaccount">
            <br />
            <input type="hidden" name="B_TRANSFER_FROM_ACCOUNT" value="1" />
            <table class="tcal">
              <tr>
                <th>Waren im Konto</th>
              </tr>
              <tr>
                <td tal:define="storage TRADEPOST/getStorage">
                  <tal:block tal:condition="storage" tal:repeat="stor storage">
                    <input type="hidden" name="commodities[]" tal:attributes="value stor/getCommodity/getId" />
                    <div tal:condition="repeat/stor/odd" style="float: right; width: 50%;">
                      <metal:macro metal:use-macro="macros.xhtml/commoditySelection"
                        tal:define="name stor/getCommodity/getName; commodityId stor/getCommodity/getId; amount stor/getAmount" />
                    </div>
                    <div tal:condition="repeat/stor/even" style="float: left; width: 50%;">
                      <metal:macro metal:use-macro="macros.xhtml/commoditySelection"
                        tal:define="name stor/getCommodity/getName; commodityId stor/getCommodity/getId; amount stor/getAmount" />
                    </div>
                    <br tal:condition="repeat/stor/odd" style="clear: both;" />
                  </tal:block>
                  <tal:block tal:condition="not:storage">
                    Keine Waren vorhanden
                  </tal:block>
                </td>
              </tr>
            </table>
          </metal:macro>
          <metal:macro metal:use-macro="transfertoaccount" />
        </div>
        <br />
        <div style="width: 100%; text-align: center;">
          <input type="button" class="button" value="max" onclick="maximizeCommodityAmounts();" />
          <input type="submit" class="button" value="Transferieren" />
        </div>
      </form>
    </tal:block>
    <tal:block tal:condition="not:HAS_LICENSE">
      <table class="tcal">
        <tr>
          <td tal:content="structure nl2br:TRADEPOST/getTradePostDescription">DESCRIPTION</td>
        </tr>
      </table>
      <br />
      <table class="tcal" tal:condition="CAN_BUY_LICENSE">
        <tr>
          <th>Lizenz erwerben</th>
        </tr>
        <tr>
          <td>
            Um an diesem Posten Handel betreiben zu können ist eine Lizenz nötig. Die Gebühr für eine
            <span tal:replace="LICENSEDAYS">DAYS</span> Tage gültige Lizenz beträgt:<br />
            <span tal:replace="LICENSECOST">COST</span> <span
              tal:replace="LICENSECOMMODITYNAME">COMMODITY</span><br /><br />
            Diese Gebühr kann entweder über ein bereits bestehendes Warenkonto an einem anderen Posten oder aus dem
            Frachtraum des Schiffes beglichen werden.<br /><br />
            <input class="button" type="button" value="Bezahlmethode wählen"
              onclick="tradeMenuChoosePayment(${TRADEPOST/getId});" />

          </td>
        </tr>
      </table>
      <table class="tcal" tal:condition="not:CAN_BUY_LICENSE">
        <tr>
          <th>Lizenzerwerb nicht möglich</th>
        </tr>
        <tr>
          <td>
            Dieser Handelsposten hat noch keine Gebühren für den Lizenzerwerb eingestellt.
          </td>
        </tr>
      </table>
    </tal:block>
  </div>
</metal:macro>
<metal:macro metal:define-macro="trademenupayment">
  <div id="trademenucontent" style="width: 400px;">
    <table class="tcal">
      <tr>
        <td>
          Es werden nur angedockte Schiffe/Konten aufgelistet auf denen genug Waren vorhanden sind um die Gebühr zu
          begleichen.<br /><br />
          <img src="assets/commodities/${LICENSECOMMODITY}.png" tal:attributes="title LICENSECOMMODITYNAME" /> <span
            tal:replace="LICENSECOST">COST</span> für <span tal:replace="LICENSEDAYS">DAYS</span> Tage.
        </td>
      </tr>
    </table>
    <br /><br />
    <input type="hidden" name="sstrajax" id="sstrajax" tal:attributes="value THIS/getSessionString" />
    <table class="tcal">
      <tr>
        <th>Bezahlmethode wählen</th>
      </tr>
      <tr>
        <td>
          <div style="float: left; width: 190px;">
            <strong>Angedockte Schiffe</strong>
            <div tal:repeat="ship DOCKED_SHIPS_FOR_LICENSE">
              - <a href="javascript:void(0);" onclick="payTradeLicense(${TRADEPOST/getId},'ship',${ship/getId})"
                tal:content="structure bbcode:ship/getName">NAME</a>
            </div>
          </div>
          <div style="padding-left: 6px; float: right; width: 190px;">
            <strong>Warenkonten</strong>
            <div tal:repeat="acc ACCOUNTS_FOR_LICENSE">
              - <a href="javascript:void(0);"
                onclick="payTradeLicense(${TRADEPOST/getId},'account',${acc/getTradePost/getId})"
                tal:content="structure bbcode:acc/getTradePost/getName">NAME</a>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</metal:macro>
<metal:macro metal:define-macro="regioninfo">
  <tal:block tal:condition="THIS/getInformation">
    <br />
    <metal:macro metal:use-macro="html/sitemacros.xhtml/systeminformation" />
  </tal:block>
  <metal:macro metal:use-macro="html/databasemacros.xhtml/regioninfo" />
</metal:macro>
<metal:macro metal:define-macro="sectorscan">
  <tal:block tal:condition="THIS/getInformation">
    <br />
    <metal:macro metal:use-macro="html/sitemacros.xhtml/systeminformation" />
  </tal:block>
  <br />
  <tal:block tal:condition="not:ERROR">
    <table class="tcal">
      <tr>
        <td rowspan="2" style="width: 30px; vertical-align: top;">
          <img src="assets/map/${MAP_PATH}" />
        </td>
        <th tal:content="SHIP/getCurrentMapField/getFieldType/getName">NAME</th>
      </tr>
      <tr>
        <td>
          Energiekosten: ${SHIP/getCurrentMapField/getFieldType/getEnergyCosts}<br />
          Schaden: ${SHIP/getCurrentMapField/getFieldType/getSpecialDamage}
          (${SHIP/getCurrentMapField/getFieldType/getDamage})
        </td>
      </tr>
    </table>
    <table class="tcal" tal:condition="SIGNATURES">
      <tr>
        <th colspan="3">Signaturen</th>
      </tr>
      <tr>
        <th>Rumpf</th>
        <th>Schiffsname</th>
        <th>Alter</th>
      </tr>
      <tr tal:repeat="sig SIGNATURES">
        <td>
          <img tal:condition="sig/getRump" src="assets/ships/${sig/getRump/getId}.png"
            tal:attributes="title sig/getRump/getName" />
          <span tal:condition="not:sig/getRump">?</span>
        </td>
        <td>
          <span tal:condition="sig/getShipName" tal:content="structure bbcode:sig/getShipName">.</span>
          <span tal:condition="not:sig/getShipName">?</span>
        </td>
        <td>
          <span tal:content="sig/getAge">.</span>
        </td>
      </tr>
    </table>
    <table class="tcal" tal:condition="php: OTHER_SIG_COUNT OR OTHER_CLOAKED_COUNT">
      <tr>
        <th colspan="2">verblasste Signaturen</th>
      </tr>
      <tr tal:condition="OTHER_SIG_COUNT">
        <td>
          ungetarnt:
        </td>
        <td>
          <span tal:content="OTHER_SIG_COUNT">.</span>
        </td>
      </tr>
      <tr tal:condition="OTHER_CLOAKED_COUNT">
        <td>
          getarnt:
        </td>
        <td>
          <span tal:content="OTHER_CLOAKED_COUNT">.</span>
        </td>
      </tr>
    </table>
  </tal:block>
</metal:macro>
<metal:macro metal:define-macro="repairoptions">
  <tal:block tal:condition="THIS/getInformation">
    <br />
    <metal:macro metal:use-macro="html/sitemacros.xhtml/systeminformation" />
  </tal:block>
  <br />
  <tal:block tal:condition="not:ERROR">
    <form id="selfrepair_form" method="post" action="ship.php">
      <input type="hidden" name="id" tal:attributes="value SHIP/getId" />
      <input type="hidden" name="sstr" tal:attributes="value THIS/getSessionString" />
      <div class="box" tal:condition="SHIP/isBase">
        <div class="box_title">Passive Reparatur <img title="Wird durch angedockte Workbees durchgeführt"
            src="assets/buttons/info2.png" style="height:16px;" /></div>
        <div class="box_body">
          <table class="tcal">
            <tr>
              <th>Workbees <img title="Anzahl der benötigten und aktuell angedockten Workbees für die Reparatur"
                  src="assets/buttons/info2.png" style="height:16px;" /></th>

              <th>Runden <img title="Anzahl der benötigten Runden um die Reparatur zu beenden"
                  src="assets/buttons/info2.png" style="height:16px;" /></th>
            </tr>
            <tr>
              <td style="text-align: center;">
                (${SHIP/getDockedWorkbeeCount}/${SHIP/getRump/getNeededRepairWorkbees})</td>
              <td style="text-align: center;">
                <span tal:replace="ROUNDS"></span>
              </td>
            </tr>

            <tr style="text-align: center;">
              <td colspan="3"> <input type="submit" class="button" value="Passive Reparatur starten"
                  name="B_STATION_REPAIR" id="repair_button" /></td>
            </tr>
          </table>
        </div>
      </div>
      <br />
      <div class="box">
        <div class="box_title">Aktive Reparatur <img title="Wird durch die Crew des Schiffes durchgeführt"
            src="assets/buttons/info2.png" style="height:16px;" /></div>
        <div class="box_body">
          <table class="tcal">
            <tr>
              <th>Beschädigtes System <img title="Durch die Crew reparierbare Systeme" src="assets/buttons/info2.png"
                  style="height:16px;" /></th>
              <th>Anzahl Ingenieure <img title="Die Anzahl Ingenieure beschleunigt die Reparatur"
                  src="assets/buttons/info2.png" style="height:16px;" /></th>
              <th>Verwendete Teile <img title="Umfang der Reparatur" src="assets/buttons/info2.png"
                  style="height:16px;" />
              </th>
              <th>Sofortreparatur <img title="Erfordert die dreifache Menge an Teilen" src="assets/buttons/info2.png"
                  style="height:16px;" /></th>
            </tr>
            <tr>
              <td>
                <select name="sid" id="systemSelect" style="width:100%;">
                  <tal:block tal:repeat="data REPAIR_OPTIONS">
                    <option tal:attributes="value data/getSystemType/value;"><span
                        tal:replace="data/getName">NAME</span>,
                      aktuell: <span tal:replace="data/getStatus">STATUS</span>%</option>
                  </tal:block>
                </select>
              </td>
              <td style="text-align: center;">
                <span tal:replace="ENGINEER_COUNT"></span>
              </td>
              <td>
                <label>
                  <input type="radio" name="partschoice" value="1" /> nur
                  Ersatzteile (~ auf <span tal:replace="SPARE_PARTS_ONLY">PERCENTAGE</span>%)</label>
                <br />
                <label>
                  <input type="radio" name="partschoice" value="2" /> nur
                  Systemkomponenten (~ auf <span tal:replace="SYSTEM_COMPONENTS_ONLY">PERCENTAGE</span>%)</label>
                <br />
                <label>
                  <input type="radio" name="partschoice" value="3" />
                  beides (~ auf <span tal:replace="BOTH">PERCENTAGE</span>%)</label>
              </td>
              <td>
                <input type="checkbox" name="instantrepair" /> sofort
              </td>
            </tr>
            <tr style="text-align: center;">
              <td colspan="4"><input type="submit" class="button" value="Aktive Reparatur starten" name="B_SELF_REPAIR"
                  id="selfrepair_button" /></td>
            </tr>
          </table>
        </div>
      </div>
    </form>
  </tal:block>
</metal:macro>
<metal:macro metal:define-macro="astroentries">
  <div id="astroentries">
    <div style="display: grid; grid-template-columns: ${GRID_COLUMNS}; color: #dddddd;">
      <div tal:repeat="field FIELDS" style="margin: 1px;" class="cfu">
        <span>${field/getSectorString}</span>
      </div>
    </div>
  </div>
</metal:macro>

<metal:macro metal:define-macro="colonization">
  <div tal:attributes="style string:${SURFACE/getSurfaceTileStyle}" tal:define="sstr THIS/getSessionString">
    <tal:block tal:repeat="field SURFACE/getSurface">
      <div style="width: 40px; height: 40px;" tal:attributes="class field/getCssClass">
        <div>
          <div>
            <img tal:condition="not:field/isColonizeAble" style="width: 40px; height: 40px;" title="runtime"
              tal:attributes="title planetFieldTitle:field"
              src="assets/generated/fields/${field/getDayNightPrefix}${field/getFieldType}.png" />
            <a tal:condition="field/isColonizeAble"
              href="?id=${SHIP/getId}&B_COLONIZE=1&colid=${currentColony/getId}&field=${field/getId}&sstr=${sstr}">
              <img style="width: 40px; height: 40px;" title="runtime" tal:attributes="title planetFieldTitle:field"
                src="assets/generated/fields/${field/getDayNightPrefix}${field/getFieldType}.png" />
            </a>
          </div>
        </div>
      </div>
    </tal:block>
  </div>
  <tal:block tal:condition="currentColony/getColonyClass/getColonizeableFields">
    <br />
    <div class="divhead">Kolonisierbare Felder</div>
    <div class="divbody">
      <img src="assets/generated/fields/t${field}.png"
        tal:repeat="field currentColony/getColonyClass/getColonizeableFields" />
    </div>
  </tal:block>
</metal:macro>
<metal:macro metal:define-macro="colonyscan">
  <tal:block tal:condition="THIS/getInformation">
    <br />
    <metal:macro metal:use-macro="html/sitemacros.xhtml/systeminformation" />
  </tal:block>
  <br />
  <tal:block tal:condition="not:ERROR" tal:define="style string:margin: 1px;; width: 42px;; height: 42px;;">
    <div tal:condition="DEPOSITS">
      <table class="tcal">
        <tr>
          <th colspan="2">Ressourcenvorkommen</th>
        </tr>
        <tr tal:repeat="deposit DEPOSITS">
          <td><img src="/assets/commodities/${deposit/getCommodity/getId}.png"
              title="${deposit/getCommodity/getName}" /></td>
          <td>min: ${deposit/getMinAmount}, max: ${deposit/getMaxAmount}</td>
        </tr>
      </table>
    </div>
    <div tal:attributes="style string:${SURFACE/getSurfaceTileStyle}" tal:define="sstr THIS/getSessionString">
      <tal:block tal:repeat="field SURFACE/getSurface">
        <tal:block tal:condition="not:field/hasBuilding">
          <div tal:condition="not:field/getTerraforming" style="${style}" tal:attributes="class field/getCssClass">
            <div style="width: 40px; height: 40px;" id="field${field/getFieldId}">
              <div>
                <div>
                  <img style="width: 40px; height: 40px;" tal:attributes="title planetFieldTitle:field"
                    src="assets/generated/fields/${field/getDayNightPrefix}${field/getFieldType}.png" />
                </div>
              </div>
            </div>
          </div>
          <div tal:condition="field/getTerraforming" style="${style};" tal:attributes="class field/getCssClass">
            <div
              style="background-image: url(assets/generated/fields/${field/getDayNightPrefix}${field/getFieldType}.png); width: 40px; height: 40px;"
              id="field${field/getFieldId}">
              <div>
                <div>
                  <img class="action" style="width: 40px; height: 40px;" title="runtime"
                    tal:attributes="title planetFieldTitle:field"
                    src="assets/terraform/${field/getTerraforming/getId}/${field/getDayNightPrefix}.png" />
                </div>
              </div>
            </div>
          </div>
        </tal:block>
        <tal:block tal:condition="field/hasBuilding">
          <div tal:condition="not:field/isUnderConstruction" style="${style}" tal:attributes="class field/getCssClass">
            <div
              style="background-image: url(assets/generated/fields/${field/getDayNightPrefix}${field/getFieldType}.png); width: 40px; height: 40px;"
              id="field${field/getFieldId}">
              <div>
                <div>
                  <a
                    href="?id=${SHIP/getId}&B_ATTACK_BUILDING=1&colid=${currentColony/getId}&field=${field/getId}&sstr=${sstr}">
                    <img style="width: 40px; height: 40px;" title="Gebäude bombardieren: ${planetFieldTitle:field}"
                      src="assets/generated/buildings/${field/getBuildingId}/${field/getBuilding/getBuildingType}${field/getBuildingState}${field/getDayNightPrefix}.png" />
                  </a>
                </div>
              </div>
            </div>
          </div>
          <div tal:condition="field/isUnderConstruction" style="${style}" tal:attributes="class field/getCssClass">
            <div
              style="background-image: url(assets/generated/fields/${field/getDayNightPrefix}${field/getFieldType}.png); width: 40px; height: 40px;"
              id="field${field/getFieldId}"><a
                href="?id=${SHIP/getId}&B_ATTACK_BUILDING=1&colid=${currentColony/getId}&field=${field/getId}&sstr=${sstr}">
                <div
                  style="width: 40px; height: 40px; background-image: url(assets/generated/buildings/${field/getPictureType}${field/getDayNightPrefix}.png)">

                  <div style="height: 40px; overflow: hidden; width: ${field/getOverlayWidth}px;">
                    <a
                      href="?id=${SHIP/getId}&B_ATTACK_BUILDING=1&colid=${currentColony/getId}&field=${field/getId}&sstr=${sstr}">
                      <img style="width: 40px; height: 40px;" tal:attributes="title planetFieldTitle:field"
                        src="assets/generated/buildings/${field/getBuildingId}/${field/getBuilding/getBuildingType}a${field/getDayNightPrefix}.png" /></a>
                  </div>
                </div>
              </a>
            </div>
          </div>
        </tal:block>
      </tal:block>
    </div>
  </tal:block>
</metal:macro>

</html>
