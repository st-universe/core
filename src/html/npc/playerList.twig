{% from 'html/macros.twig' import userAvatar, userInfo, pmWindow, userProfile %}

{% extends "html/npcdefaults.twig" %}

{% block body %}
{% include 'html/breadcrumb.twig' %}
<script src="{{ JAVASCRIPTPATH }}/js/ally.js"></script>
<script src="{{ JAVASCRIPTPATH }}/js/npc.js"></script>
<div class="userList">
    {% for listEntry in LIST %}
    {% set user = listEntry.getUser %}
    {% set userId = user.getId %}
    <div class="userListItem"
        style="width: 100% !important; max-width: 100% !important; grid-template-columns: minmax(300px, 25%) minmax(200px, 25%) auto !important; display: grid !important;">
        <div style="display: flex; flex-direction: row;">
            <div style="margin-right: 10px;">
                {{ userAvatar(user) }}
            </div>
            <div>
                <div class="userListItemName">
                    {{ userInfo(user) }}
                </div>
                <div class="userListItemAllianceName">
                    {% set alliance = user.getAlliance %}
                    {% if alliance %}
                    <a href="/alliance.php?id={{ alliance.getId }}">{{ alliance.getName|bbcode }}</a>
                    {% else %}
                    <span>-</span>
                    {% endif %}
                </div>
                <div class="userListItemButtons">
                    <img src="/assets/rassen/{{ user.getFactionId }}s.png" />
                    {{ userProfile(userId) }}
                    {{ pmWindow(USER, userId) }}
                </div>
                <div class="userBoxDetailAddendum">
                    <div>
                        Spielt seit: {{ user.getRegistration.getCreationDate|date('d.m.Y H:i') }}
                    </div>
                    <div class="player-details-form" id="detailsForm-{{ userId }}">
                        <div style="margin: 10px 0;">
                            <label for="reason-{{ userId }}">Grund für Einsicht:</label>
                            <input type="text" id="reason-{{ userId }}" name="reason" size="20" required>
                            <input type="submit" class="button" value="Details anzeigen"
                                onclick="showPlayerDetails({{ userId }})"></input>
                        </div>
                    </div>
                    <div class="player-details" id="playerDetails-{{ userId }}" style="display: none;">
                        <div>
                            <img title="Zuletzt online" src="/assets/buttons/time.png" />
                            {{ user.getLastAction|stuDateTime }}
                        </div>
                        <div>
                            <img src="/assets/navigation/menu_ships0.png" height="20" width="20"
                                title="Crew auf Schiffen/Stationen" />
                            <span>{{ listEntry.getCrewOnShips }}</span> / <span>{{ listEntry.getCrewLimit }}</span>
                            <img src="/assets/bev/bev_free_5_1.png" height="20" width="20" title="globales Crewlimit" />
                        </div>
                        <div>STATUS:
                            <span style="color: {{ listEntry.getUserStateColor }};">{{ listEntry.getUserStateDescription
                                }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="playerColonies-{{ userId }}" class="player-colonies player-details-section"
            style="display: none; flex-wrap: wrap; align-items: center; padding-left: 10px;">
            {% for col in listEntry.getColonies %}
            {% set classId = col.getColonyClass.getId %}
            {% set title = col.getName|bbcode2txt %}
            {% set system = col.getSystem %}

            <img src="/assets/planets/{{ classId }}.png"
                title="Kolonieinformationen: {{ title }}&#10;Koordinaten: {{ col.getSx }}|{{ col.getSy }}&#10;System: {{ system.getName|bbcode2txt }}-System ({{ system.getCx }}|{{ system.getCy }})"
                style="margin: 2px;" />
            {% endfor %}
        </div>
        <div id="playerShips-{{ userId }}" class="player-ships player-details-section"
            style="display: none; padding-left: 10px;">
            {% for rump in listEntry.getShipRumpList %}
            <div style="display: inline-block; padding-left: 10px; text-align: center; margin-bottom: 5px;">
                {{ rump.amount }} {{ rump.name }}<br />
                <a href="javascript:void(0);" onclick="showNPCMemberRumpInfo(this, {{ userId }}, {{ rump.rump_id }});">
                    <img src="/assets/ships/{{ rump.rump_id }}.png" title="{{ rump.name }} (Klick für Details)" />
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}